{% extends "question/base.html" %} {% load static %} {% block content %} 
{% include "question/header.html" %}
<div class="details">
  <div class="ques">
    <h1 id="ques">{{ ques.question_text }}</h1>
    {% comment %}
    <p id="timer">02:00</p>
    {% endcomment %}
  </div>
  <form id="form" method="POST">
    {% csrf_token %}
    <input
      type="text"
      name="ans"
      id="answer"
      placeholder="Answer"
      required
      autocomplete="off"
    />
    <button id="button" type="submit">Submit</button>
  </form>
  <div class="likes">
    <button>
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g clip-path="url(#clip0)">
          <path
            d="M5 22H0V10H5V22ZM22.615 13.588C21.758 13.473 22.037 12.854 22.646 12.666C23.167 12.506 24 12.166 24 11.156C24 10.484 23.5 9.594 21.729 9.666C20.501 9.716 18.063 9.468 16.75 8.781C17.656 5.125 17.438 0 15.062 0C13.468 0 13.166 1.807 12.687 3.469C11.466 7.711 9.375 9.486 7 10.354V21.232C11.382 21.933 13.345 24 17.505 24C20.703 24 22.357 22.265 22.357 21.334C22.357 20.999 22.085 20.761 21.397 20.708C20.586 20.646 20.663 19.896 21.428 19.755C22.696 19.521 23.254 18.841 23.254 18.212C23.254 17.683 22.858 17.19 22.156 17.031C21.319 16.842 21.492 16.274 22.187 16.219C23.32 16.129 23.875 15.455 23.875 14.809C23.875 14.244 23.451 13.7 22.615 13.588V13.588Z"
            fill="black"
            fill-opacity="0.4"
          />
        </g>
        <defs>
          <clipPath id="clip0">
            <rect width="24" height="24" fill="white" />
          </clipPath>
        </defs>
      </svg>
    </button>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
  let count = 120;
  let minutes, seconds;
  setInterval(function () {
    minutes = parseInt(count / 60, 10);
    seconds = parseInt(count % 60, 10);
    minutes = minutes < 10 ? "0" + minutes : minutes;
    seconds = seconds < 10 ? "0" + seconds : seconds;
    document.getElementById("timer").textContent = minutes + ":" + seconds;
    count = count - 1;
    if (count < 0) {
      $.ajax({
        type: "POST",
        url: "{% url 'detail' %}",
        data: {
          csrfmiddlewaretoken: "{{ csrf_token }}",
          expired: "YES",
        },
        success: (data) => {
          if (data.ques === "done") {
            window.location.href = "/end/" + parseInt(data.score);
          }
          let ques = data.ques;
          if (ques !== "wrong" && ques !== "done") {
            $("#ques").html(ques);
            $("#form")[0].reset();
            count = 120;
          }
        },
      });
    }
  }, 1000);

  $("#form").on("submit", (e) => {
    e.preventDefault();
    $.ajax({
      type: "POST",
      url: "{% url 'detail' %}",
      data: {
        csrfmiddlewaretoken: "{{ csrf_token }}",
        ans: $("#answer").val(),
        expired: "NO",
      },
      success: (data) => {
        if (data.ques === "done") {
          window.location.href = "/end/" + parseInt(data.score);
        }
        if (data.ques !== "wrong" && data.ques !== "done") {
          $("#ques").html(data.ques);
          $("#form")[0].reset();
          count = 120;
        }
        if (data.ques === "wrong") {
          $("#form")[0].reset();
        }
      },
    });
  });
</script>

{% endblock %}
